<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Indie Search</title>
    <meta
      name="description"
      content="A statically hosted indie search interface powered by Exa."
    />
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light;
        --bg: #0c1320;
        --card: rgba(255, 255, 255, 0.05);
        --panel-bg: rgba(255, 255, 255, 0.12);
        --accent: #1c82ff;
        --muted: #9ba7c6;
        --border: rgba(255, 255, 255, 0.18);
        --text: #f9fbff;
        --note: #cfd9ff;
        font-family: "Space Grotesk", "Inter", system-ui, sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        margin: 0;
        background: radial-gradient(circle at top, rgba(76, 197, 255, 0.08), transparent 40%),
          linear-gradient(120deg, #0e1427, #050811 55%, #10193c);
        color: var(--text);
      }

      body::after {
        content: "";
        position: fixed;
        inset: 0;
        background-image: radial-gradient(circle, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
        background-size: 3px 3px;
        pointer-events: none;
        opacity: 0.25;
        mix-blend-mode: screen;
      }

      .page-shell {
        position: relative;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 4vw clamp(1.5rem, 2vw, 2.25rem);
        gap: clamp(1.5rem, 2vw, 2.5rem);
      }

      main {
        display: flex;
        flex-wrap: wrap;
        gap: clamp(1.5rem, 2vw, 2.75rem);
        justify-content: center;
      }

      .panel {
        position: relative;
        border: 1px solid var(--border);
        border-radius: 1.5rem;
        background: var(--panel-bg);
        backdrop-filter: blur(18px);
        min-width: 280px;
        padding: clamp(1.5rem, 2vw, 2rem);
        box-shadow: 0 20px 45px rgba(6, 9, 20, 0.6);
      }

      .key-panel {
        flex: 1 1 320px;
        max-width: 420px;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .panel h1 {
        margin: 0;
        font-size: clamp(2.25rem, 3vw, 2.9rem);
        line-height: 1.2;
        letter-spacing: -0.02em;
      }

      .eyebrow {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.3em;
        color: var(--note);
      }

      .panel p {
        margin: 0;
        color: var(--muted);
        line-height: 1.6;
      }

      .api-card {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      label {
        font-size: 0.95rem;
      }

      input {
        width: 100%;
        border-radius: 0.9rem;
        border: 1px solid rgba(255, 255, 255, 0.4);
        padding: 0.85rem 1rem;
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        font-size: 1rem;
        font-family: inherit;
        outline: none;
        transition: border 0.2s ease, background 0.2s ease;
      }

      input:focus {
        border-color: var(--accent);
        background: rgba(255, 255, 255, 0.15);
      }

      .field-row {
        display: flex;
        gap: 0.75rem;
        align-items: stretch;
      }

      .field-row button {
        flex: 0 0 auto;
      }

      button {
        border: 0;
        border-radius: 999px;
        font-size: 0.95rem;
        font-weight: 600;
        padding: 0 1.4rem;
        letter-spacing: 0.04em;
        background: linear-gradient(135deg, #00bfff, #1c82ff);
        color: #fff;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      button:hover {
        transform: translateY(-1px) scale(1.01);
        box-shadow: 0 10px 25px rgba(28, 130, 255, 0.35);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .search-panel {
        flex: 1 1 500px;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .search-input {
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }

      .search-input input {
        flex: 1;
      }

      .results-list {
        display: grid;
        gap: 1rem;
        min-height: 200px;
      }

      .empty {
        color: var(--muted);
        font-size: 0.95rem;
        line-height: 1.6;
      }

      .result-card {
        border: 1px solid rgba(255, 255, 255, 0.15);
        padding: 1.1rem 1.2rem;
        border-radius: 1rem;
        background: rgba(255, 255, 255, 0.02);
        animation: cardFade 0.35s ease;
      }

      @keyframes cardFade {
        from {
          opacity: 0;
          transform: translate3d(0, 10px, 0);
        }
        to {
          opacity: 1;
          transform: translate3d(0, 0, 0);
        }
      }

      .result-card a {
        display: inline-block;
        color: var(--accent);
        font-size: 1.15rem;
        font-weight: 600;
        text-decoration: none;
      }

      .result-card a:hover {
        text-decoration: underline;
      }

      .result-url {
        font-size: 0.82rem;
        color: var(--note);
        margin-top: 0.35rem;
        font-family: "JetBrains Mono", monospace;
      }

      .status-message {
        font-size: 0.95rem;
        min-height: 1.2rem;
        color: var(--muted);
        position: relative;
      }

      .status-message[data-state="loading"] {
        color: #64b0ff;
      }

      .status-message[data-state="loading"]::after {
        content: "•";
        margin-left: 0.35rem;
        animation: pulseDot 1s infinite;
      }

      @keyframes pulseDot {
        0% {
          opacity: 0.2;
          transform: scale(0.9);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
        100% {
          opacity: 0.2;
          transform: scale(0.9);
        }
      }

      .status-message[data-state="error"] {
        color: #ff7c7c;
      }

      .key-status {
        font-size: 0.9rem;
        color: var(--note);
      }

      .key-note {
        font-size: 0.85rem;
        color: var(--note);
        line-height: 1.5;
      }

      .footer-note {
        text-align: center;
        font-size: 0.82rem;
        color: var(--note);
        padding-bottom: 1.5rem;
      }

      @media (max-width: 720px) {
        .panel {
          border-radius: 1.15rem;
          padding: 1.25rem;
        }

        .field-row {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="page-shell">
      <main>
        <section class="panel key-panel">
          <p class="eyebrow">Indie Search</p>
          <h1>Search with an intentional, indie web palette.</h1>
          <p>
            Supply your own Exa API key, store it locally, and run searches just like a
            cozy, commitment-friendly search engine.
          </p>
          <div class="api-card">
            <label for="api-key">Add your key here</label>
            <div class="field-row">
              <input id="api-key" type="password" autocomplete="off" placeholder="sk-***" />
              <button id="save-key" type="button">Save key</button>
            </div>
            <p class="key-status" id="key-status">Key not saved yet.</p>
            <p class="key-note">
              This page stores your key in the browser’s local storage so that the key never leaves your
              machine unless you share it. You can delete it at any time or clear storage to reset access.
            </p>
          </div>
        </section>
        <section class="panel search-panel">
          <form class="search-input" id="search-form">
            <input
              id="search-input"
              name="s"
              autocomplete="off"
              placeholder="What are you looking for?"
            />
            <button id="search-button" type="submit">Search</button>
          </form>
          <div class="status-message" id="status-message"></div>
          <div class="results-list" id="results-list">
            <p class="empty">Awaiting your first search.</p>
          </div>
        </section>
      </main>
      <footer class="footer-note">Results provided by Exa.ai.</footer>
    </div>
    <script>
      const storageKey = "indieSearchKey";
      const maxResults = 10;

      const keyInput = document.getElementById("api-key");
      const saveKeyButton = document.getElementById("save-key");
      const keyStatus = document.getElementById("key-status");
      const searchForm = document.getElementById("search-form");
      const searchInput = document.getElementById("search-input");
      const resultsList = document.getElementById("results-list");
      const searchButton = document.getElementById("search-button");
      const statusMessage = document.getElementById("status-message");

      const searchProvider = {
        name: "Exa",
        async search(query, key) {
          const response = await fetch("https://api.exa.ai/search", {
            method: "POST",
            headers: {
              "Accept": "application/json",
              "Content-Type": "application/json",
              "x-api-key": key
            },
            body: JSON.stringify({
              query,
              type: "auto",
              contents: {
                highlights: {
                  maxCharacters: 4000
                }
              }
            })
          });

          if (!response.ok) {
            const text = await response.text();
            throw new Error(text || "Search failed. Please double-check your key.");
          }

          const payload = await response.json();
          const hits =
            payload?.results ||
            payload?.response?.results ||
            payload?.data?.results ||
            (Array.isArray(payload) ? payload : []);

          return hits.slice(0, maxResults).map((hit) => ({
            title:
              hit?.title || hit?.description || hit?.meta?.title || hit?.label || "Untitled result",
            url: hit?.url || hit?.link || hit?.metadata?.url || "",
            description:
              hit?.description ||
              hit?.summary ||
              Array.isArray(hit?.contents)
                ? hit.contents.find((entry) => entry?.type === "highlight")?.text || hit.contents.map((entry) => entry?.text).join(" ")
                : hit?.snippet ||
              "No description available."
          }));
        }
      };

      let currentKey = null;

      function setStatus(message, state) {
        statusMessage.textContent = message;
        if (state) {
          statusMessage.setAttribute("data-state", state);
        } else {
          statusMessage.removeAttribute("data-state");
        }
      }

      function updateKeyStatus() {
        if (currentKey) {
          keyStatus.textContent = "Key saved locally. Ready to search.";
          searchButton.disabled = false;
        } else {
          keyStatus.textContent = "Key not saved yet.";
          searchButton.disabled = true;
          setStatus("Enter a key above before searching.");
        }
      }

      function loadKeyFromStorage() {
        try {
          const stored = localStorage.getItem(storageKey);
          if (stored) {
            currentKey = stored;
            keyInput.value = stored;
          }
        } catch (error) {
          console.warn("Unable to access localStorage", error);
        }
      }

      function saveKey() {
        const trimmed = keyInput.value.trim();
        if (!trimmed) {
          setStatus("Enter a valid key before saving.", "error");
          return;
        }

        try {
          localStorage.setItem(storageKey, trimmed);
          currentKey = trimmed;
          setStatus("Key stored successfully.");
          updateKeyStatus();
        } catch (error) {
          console.error(error);
          setStatus("Unable to store the key — check your browser settings.", "error");
        }
      }

      function buildResultCard(item) {
        const card = document.createElement("article");
        card.className = "result-card";

        const titleLink = document.createElement("a");
        titleLink.textContent = item.title;
        titleLink.href = item.url || "#";
        titleLink.target = "_blank";
        titleLink.rel = "noopener noreferrer";

        const description = document.createElement("p");
        description.textContent = item.description;

        const meta = document.createElement("p");
        meta.className = "result-url";
        meta.textContent = item.url ? item.url : "Link unavailable";

        card.append(titleLink, description, meta);
        return card;
      }

      function renderResults(results) {
        resultsList.innerHTML = "";
        if (!results.length) {
          const placeholder = document.createElement("p");
          placeholder.className = "empty";
          placeholder.textContent = "No results yet. Try a different query.";
          resultsList.appendChild(placeholder);
          return;
        }

        results.forEach((result) => {
          const card = buildResultCard(result);
          resultsList.appendChild(card);
        });
      }

      async function runSearch(query) {
        if (!currentKey) {
          setStatus("Add a key before searching.", "error");
          return;
        }

        if (!query) {
          setStatus("Type something and press Search.", "error");
          return;
        }

        setStatus(`Searching for “${query}”`, "loading");
        searchButton.disabled = true;

        try {
          const response = await searchProvider.search(query, currentKey);
          renderResults(response);
          const successMessage = response.length
            ? `Showing ${response.length} result${response.length === 1 ? "" : "s"}`
            : "No matches from the provider.";
          setStatus(successMessage);
          updateQuery(query);
        } catch (error) {
          console.error(error);
          renderResults([]);
          setStatus(error.message || "Search failed.", "error");
        } finally {
          searchButton.disabled = !currentKey;
        }
      }

      function updateQuery(query) {
        const params = new URLSearchParams(window.location.search);
        if (query) {
          params.set("s", query);
        } else {
          params.delete("s");
        }
        const queryString = params.toString();
        const newUrl = queryString
          ? `${window.location.pathname}?${queryString}`
          : window.location.pathname;
        window.history.replaceState({}, "", newUrl);
      }

      function syncQueryFromUrl() {
        const params = new URLSearchParams(window.location.search);
        const searchParam = params.get("s");
        if (searchParam) {
          searchInput.value = searchParam;
          if (currentKey) {
            runSearch(searchParam);
          } else {
            setStatus("Save your key to load the saved search.");
          }
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadKeyFromStorage();
        updateKeyStatus();

        saveKeyButton.addEventListener("click", () => {
          saveKey();
          if (searchInput.value.trim()) {
            runSearch(searchInput.value.trim());
          }
        });

        keyInput.addEventListener("keypress", (event) => {
          if (event.key === "Enter") {
            event.preventDefault();
            saveKeyButton.click();
          }
        });

        searchForm.addEventListener("submit", (event) => {
          event.preventDefault();
          runSearch(searchInput.value.trim());
        });

        syncQueryFromUrl();
      });
    </script>
  </body>
</html>
